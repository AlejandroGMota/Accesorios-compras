<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Catálogo BuyTiti</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f9f9f9;
            margin: 0;
            padding: 20px;
            color: #333;
        }

        h1 {
            color: #0056b3;
            text-align: center;
            font-size: clamp(1.5em, 4vw, 2.5em);
            margin-bottom: 10px;
        }

        .subtitle {
            text-align: center;
            color: #666;
            margin-bottom: 20px;
            font-size: 0.9em;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        /* Filtros por subcategoría (checkboxes) */
        .filters {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            justify-content: center;
            margin-bottom: 20px;
            padding: 15px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .filters-title {
            width: 100%;
            text-align: center;
            font-weight: 600;
            color: #0056b3;
            margin-bottom: 5px;
            font-size: 0.9em;
        }

        .filter-checkbox {
            display: none;
        }

        .filter-label {
            display: inline-block;
            padding: 6px 14px;
            border: 2px solid #0056b3;
            background-color: white;
            color: #0056b3;
            border-radius: 25px;
            cursor: pointer;
            font-size: clamp(0.75em, 1.8vw, 0.9em);
            transition: all 0.3s ease;
            font-weight: 500;
            user-select: none;
        }

        .filter-label:hover {
            background-color: #e1f0ff;
        }

        .filter-checkbox:checked + .filter-label {
            background-color: #0056b3;
            color: white;
        }

        .filter-actions {
            width: 100%;
            text-align: center;
            margin-top: 5px;
        }

        .filter-actions button {
            padding: 5px 12px;
            border: 1px solid #ccc;
            background: #f5f5f5;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.8em;
            margin: 0 3px;
        }

        .filter-actions button:hover {
            background: #e0e0e0;
        }

        /* Búsqueda */
        .search-box {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-bottom: 20px;
            padding: 15px;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .search-input {
            padding: 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            width: 300px;
            transition: border-color 0.3s;
        }

        .search-input:focus {
            outline: none;
            border-color: #0056b3;
        }

        .sort-select {
            padding: 10px 15px;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            font-size: 16px;
            background-color: white;
            cursor: pointer;
            transition: border-color 0.3s;
        }

        .sort-select:focus {
            outline: none;
            border-color: #0056b3;
        }

        /* Tabla */
        table {
            width: 100%;
            border-collapse: collapse;
            background-color: white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            border-radius: 10px;
            overflow: hidden;
        }

        thead {
            background-color: #0056b3;
            color: white;
        }

        th {
            padding: 15px 10px;
            text-align: left;
            font-size: clamp(0.8em, 2vw, 1em);
        }

        td {
            padding: 12px 10px;
            border-bottom: 1px solid #eee;
            font-size: clamp(0.8em, 2vw, 0.95em);
            vertical-align: middle;
        }

        tr:hover {
            background-color: #e1f0ff;
        }

        tr:last-child td {
            border-bottom: none;
        }

        .product-image {
            width: 70px;
            height: 70px;
            object-fit: contain;
            border-radius: 8px;
            background-color: #f5f5f5;
        }

        .product-name {
            font-weight: 600;
            color: #333;
        }

        .category-tag {
            display: inline-block;
            padding: 2px 8px;
            background-color: #e1f0ff;
            color: #0056b3;
            border-radius: 15px;
            font-size: 0.75em;
            font-weight: 500;
            margin: 1px 2px;
        }

        .price-tag {
            font-weight: 700;
            color: #27ae60;
            font-size: 1.1em;
        }

        .price-original {
            text-decoration: line-through;
            color: #999;
            font-size: 0.85em;
            font-weight: 400;
        }

        .sale-badge {
            display: inline-block;
            padding: 2px 6px;
            background-color: #e74c3c;
            color: white;
            border-radius: 4px;
            font-size: 0.7em;
            font-weight: 700;
            margin-left: 4px;
        }

        .stock-text {
            font-size: 0.8em;
            color: #666;
        }

        .stock-text.out {
            color: #e74c3c;
            font-weight: 600;
        }

        .buy-link {
            display: inline-block;
            padding: 8px 16px;
            background-color: #ff6600;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            font-size: 0.85em;
            font-weight: 500;
            transition: background-color 0.3s, transform 0.2s;
        }

        .buy-link:hover {
            background-color: #cc5200;
            transform: translateY(-1px);
        }

        /* Back link */
        .back-link {
            display: inline-block;
            margin-bottom: 20px;
            padding: 10px 20px;
            background-color: #0056b3;
            color: white;
            text-decoration: none;
            border-radius: 5px;
            transition: background-color 0.3s;
        }

        .back-link:hover {
            background-color: #003d80;
        }

        /* Loading y Error */
        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2em;
            color: #666;
        }

        .loading::after {
            content: '';
            animation: dots 1.5s infinite;
        }

        @keyframes dots {
            0%, 20% { content: '.'; }
            40% { content: '..'; }
            60%, 100% { content: '...'; }
        }

        .error {
            text-align: center;
            padding: 40px;
            font-size: 1.2em;
            color: #ff5c5c;
            background-color: #ffe6e6;
            border-radius: 10px;
        }

        .no-results {
            text-align: center;
            padding: 40px;
            font-size: 1.1em;
            color: #666;
            background-color: #f0f0f0;
            border-radius: 10px;
        }

        .results-count {
            text-align: center;
            margin-bottom: 15px;
            color: #666;
            font-size: 0.95em;
        }

        /* Responsive */
        @media (max-width: 600px) {
            th, td {
                padding: 8px 5px;
            }

            .product-image {
                width: 50px;
                height: 50px;
            }

            .filter-label {
                padding: 5px 10px;
                font-size: 0.8em;
            }

            .search-box {
                flex-direction: column;
                align-items: center;
            }

            .search-input {
                width: 100%;
                max-width: 280px;
            }

            .buy-link {
                padding: 6px 12px;
                font-size: 0.8em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <a href="../index.html" class="back-link">← Volver</a>
        <h1>Catálogo BuyTiti</h1>
        <p class="subtitle">Productos para comprar - Precios y enlaces directos</p>

        <!-- Filtros por subcategoría (checkboxes) -->
        <div class="filters" id="filters">
            <div class="filters-title">Subcategorías</div>
        </div>

        <!-- Búsqueda y ordenamiento -->
        <div class="search-box">
            <input type="text" id="searchInput" class="search-input" placeholder="Buscar producto...">
            <select id="sortSelect" class="sort-select">
                <option value="default">Ordenar por...</option>
                <option value="price-asc">Precio: menor a mayor</option>
                <option value="price-desc">Precio: mayor a menor</option>
                <option value="name-asc">Nombre: A - Z</option>
                <option value="name-desc">Nombre: Z - A</option>
            </select>
        </div>

        <div id="results-count" class="results-count"></div>

        <div id="content">
            <div class="loading">Cargando catálogo</div>
        </div>
    </div>

    <script>
        let allProducts = [];
        let filteredProducts = [];
        let selectedCategories = new Set();

        // Cargar productos del JSON
        async function loadProducts() {
            const contentDiv = document.getElementById('content');
            try {
                const response = await fetch('productos.json');
                if (!response.ok) throw new Error('No se pudo cargar el catálogo');
                allProducts = await response.json();
                filteredProducts = [...allProducts];
                setupFilters();
                displayProducts(filteredProducts);
            } catch (error) {
                contentDiv.innerHTML = `<div class="error">Error al cargar productos: ${error.message}</div>`;
            }
        }

        // Crear checkboxes de subcategorías
        function setupFilters() {
            const filtersDiv = document.getElementById('filters');
            // Collect all unique subcategories across all products
            const subcatSet = new Set();
            allProducts.forEach(p => {
                if (p.subcategorias) {
                    p.subcategorias.forEach(s => subcatSet.add(s));
                }
            });
            const subcategories = [...subcatSet].sort();

            filtersDiv.innerHTML = '<div class="filters-title">Subcategorías</div>';

            subcategories.forEach(cat => {
                const id = 'filter-' + cat.replace(/\s+/g, '-').toLowerCase();
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.className = 'filter-checkbox';
                checkbox.id = id;
                checkbox.value = cat;
                checkbox.addEventListener('change', () => {
                    if (checkbox.checked) {
                        selectedCategories.add(cat);
                    } else {
                        selectedCategories.delete(cat);
                    }
                    applyFilter();
                });

                const label = document.createElement('label');
                label.className = 'filter-label';
                label.htmlFor = id;
                label.textContent = cat;

                filtersDiv.appendChild(checkbox);
                filtersDiv.appendChild(label);
            });

            // Action buttons
            const actions = document.createElement('div');
            actions.className = 'filter-actions';
            actions.innerHTML = '<button onclick="clearFilters()">Limpiar filtros</button><button onclick="selectAll()">Seleccionar todas</button>';
            filtersDiv.appendChild(actions);
        }

        function clearFilters() {
            selectedCategories.clear();
            document.querySelectorAll('.filter-checkbox').forEach(cb => cb.checked = false);
            applyFilter();
        }

        function selectAll() {
            document.querySelectorAll('.filter-checkbox').forEach(cb => {
                cb.checked = true;
                selectedCategories.add(cb.value);
            });
            applyFilter();
        }

        // Aplicar filtro, búsqueda y ordenamiento
        function applyFilter() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
            const sortValue = document.getElementById('sortSelect').value;

            filteredProducts = allProducts.filter(p => {
                // Subcategory filter: if none selected, show all
                const matchCategory = selectedCategories.size === 0 ||
                    (p.subcategorias && p.subcategorias.some(s => selectedCategories.has(s)));
                const matchSearch = !searchTerm || p.nombre.toLowerCase().includes(searchTerm);
                return matchCategory && matchSearch;
            });

            switch (sortValue) {
                case 'price-asc':
                    filteredProducts.sort((a, b) => a.precio - b.precio);
                    break;
                case 'price-desc':
                    filteredProducts.sort((a, b) => b.precio - a.precio);
                    break;
                case 'name-asc':
                    filteredProducts.sort((a, b) => a.nombre.localeCompare(b.nombre));
                    break;
                case 'name-desc':
                    filteredProducts.sort((a, b) => b.nombre.localeCompare(a.nombre));
                    break;
            }

            displayProducts(filteredProducts);
        }

        // Mostrar productos en tabla
        function displayProducts(products) {
            const contentDiv = document.getElementById('content');
            const resultsCount = document.getElementById('results-count');

            if (products.length === 0) {
                contentDiv.innerHTML = '<div class="no-results">No se encontraron productos</div>';
                resultsCount.textContent = '';
                return;
            }

            resultsCount.textContent = `${products.length} producto${products.length !== 1 ? 's' : ''} encontrado${products.length !== 1 ? 's' : ''}`;

            let html = `
                <table>
                    <thead>
                        <tr>
                            <th>Imagen</th>
                            <th>Producto</th>
                            <th>Subcategorías</th>
                            <th>Precio</th>
                            <th>Stock</th>
                            <th>Comprar</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            products.forEach(product => {
                const imgSrc = product.imagen64 || product.imagen;
                const imgHtml = imgSrc
                    ? `<img src="${imgSrc}" alt="${product.nombre}" class="product-image" loading="lazy" onerror="this.style.display='none'">`
                    : '';

                // Subcategories tags
                const subcatHtml = (product.subcategorias || [])
                    .map(s => `<span class="category-tag">${s}</span>`)
                    .join(' ');

                // Price with original price and sale badge
                let priceHtml = `$${product.precio.toFixed(2)}`;
                if (product.enOferta && product.precioOriginal > product.precio) {
                    const discount = Math.round((1 - product.precio / product.precioOriginal) * 100);
                    priceHtml = `<span class="price-original">$${product.precioOriginal.toFixed(2)}</span><br>$${product.precio.toFixed(2)}<span class="sale-badge">-${discount}%</span>`;
                }

                // Stock
                const stockClass = product.stock && product.stock.toLowerCase().includes('agotado') ? 'stock-text out' : 'stock-text';
                const stockHtml = product.stock ? `<span class="${stockClass}">${product.stock}</span>` : '';

                html += `
                    <tr>
                        <td>${imgHtml}</td>
                        <td class="product-name">${product.nombre}</td>
                        <td>${subcatHtml}</td>
                        <td class="price-tag">${priceHtml}</td>
                        <td>${stockHtml}</td>
                        <td><a href="${product.link}" target="_blank" class="buy-link">Ver producto</a></td>
                    </tr>
                `;
            });

            html += '</tbody></table>';
            contentDiv.innerHTML = html;
        }

        // Búsqueda y ordenamiento en tiempo real
        document.getElementById('searchInput').addEventListener('input', applyFilter);
        document.getElementById('sortSelect').addEventListener('change', applyFilter);

        // Inicializar
        document.addEventListener('DOMContentLoaded', loadProducts);
    </script>
</body>
</html>
